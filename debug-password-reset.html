<!DOCTYPE html>
<html>
<head>
    <title>Debug Password Reset</title>
</head>
<body>
    <h1>Debug Password Reset Token</h1>
    <div id="token-info"></div>
    <div id="verification-result"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabaseUrl = 'https://kbvaekypkszvzrwlbkug.supabase.co'
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtidmFla3lwa3N6dnpyd2xia3VnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwMDQ5NzksImV4cCI6MjA2NDU4MDk3OX0.5vSllsb13X_iFdEA4MqzDB64bYn90INWhb-0V8_-ia0'
        const supabase = supabase.createClient(supabaseUrl, supabaseAnonKey)
        
        const urlParams = new URLSearchParams(window.location.search)
        const token = urlParams.get('token')
        const type = urlParams.get('type')
        
        document.getElementById('token-info').innerHTML = `
            <p><strong>Token:</strong> ${token}</p>
            <p><strong>Type:</strong> ${type}</p>
            <p><strong>Token length:</strong> ${token ? token.length : 'null'}</p>
            <p><strong>Full URL:</strong> ${window.location.href}</p>
        `
        
        if (token && type === 'recovery') {
            console.log('Attempting to verify OTP with token:', token)
            
            // Try different approaches
            Promise.all([
                // Approach 1: Direct token
                supabase.auth.verifyOtp({
                    token: token,
                    type: 'recovery'
                }).then(result => ({ method: 'direct_token', ...result })),
                
                // Approach 2: Token as token_hash
                supabase.auth.verifyOtp({
                    token_hash: token,
                    type: 'recovery'
                }).then(result => ({ method: 'token_hash', ...result })),
                
                // Approach 3: Exchange as code
                supabase.auth.exchangeCodeForSession(token)
                    .then(result => ({ method: 'exchange_code', ...result }))
            ]).then(results => {
                document.getElementById('verification-result').innerHTML = 
                    '<h2>Verification Results:</h2><pre>' + 
                    JSON.stringify(results, null, 2) + 
                    '</pre>'
                console.log('All verification results:', results)
            })
        } else {
            document.getElementById('verification-result').innerHTML = 
                '<p style="color: red;">No valid recovery token found in URL</p>'
        }
    </script>
</body>
</html>
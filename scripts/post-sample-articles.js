const { createClient } = require('@supabase/supabase-js');
const path = require('path');
require('dotenv').config({ path: path.join(__dirname, '../.env.local') });

// Supabaseクライアントの初期化
const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
);

// サンプル記事（最初の10件）
const sampleArticles = [
  {
    number: 2,
    title: "失敗しない！新人美容師のためのシャンプー技術完全ガイド",
    content: `## はじめに

美容師として最初に習得すべき技術の一つがシャンプーです。シャンプーは単なる洗髪ではなく、お客様との最初の接点であり、リラクゼーションを提供する重要なサービスです。

## シャンプーの基本技術

### 1. 準備段階
- お客様の髪質や頭皮の状態を確認
- 適切な水温の調整（38-40度）
- タオルの準備

### 2. プレシャンプー
髪全体を十分に濡らし、表面の汚れを落とします。この段階で髪の毛のもつれをほぐしておくことが重要です。

### 3. 本シャンプー
- 適量のシャンプーを手に取り、よく泡立てる
- 頭皮全体に泡を行き渡らせる
- 指の腹を使って優しくマッサージ

### 4. すすぎ
シャンプー剤が残らないよう、十分にすすぎます。すすぎ残しは頭皮トラブルの原因となるため、特に注意が必要です。

## よくある失敗と対策

1. **水圧が強すぎる**：お客様に不快感を与えないよう、適切な水圧を保つ
2. **爪を立てる**：必ず指の腹を使い、爪が当たらないよう注意
3. **すすぎ不足**：シャンプー剤が残らないよう、時間をかけて丁寧にすすぐ

## まとめ

シャンプー技術は美容師の基本中の基本です。毎日の練習を重ね、お客様に心地よいシャンプーを提供できるよう努めましょう。`,
    summary: "新人美容師向けのシャンプー技術の基本から応用まで、失敗しないためのポイントを詳しく解説します。"
  },
  {
    number: 3,
    title: "カラーリングの基礎知識：色彩理論から薬剤選定まで",
    content: `## カラーリングの重要性

現代の美容室において、カラーリングは売上の大きな部分を占める重要なメニューです。正しい知識と技術を身につけることで、お客様の満足度を高めることができます。

## 色彩理論の基礎

### 1. 色の三原色
- 赤（レッド）
- 青（ブルー）
- 黄（イエロー）

### 2. 補色関係
対極にある色同士は互いに打ち消し合う性質があります。
- 赤 ⇔ 緑
- 青 ⇔ オレンジ
- 黄 ⇔ 紫

### 3. トーンとレベル
- **レベル**：明るさの度合い（1-15）
- **トーン**：色味の種類（アッシュ、ベージュ、ピンクなど）

## 薬剤の選定方法

### 1. お客様の髪質診断
- ダメージレベル
- 髪の太さ
- 既存のカラー履歴

### 2. 希望色の確認
カラーチャートを使用して、お客様の希望を正確に把握します。

### 3. 薬剤の調合
髪質と希望色に応じて、適切な薬剤を選定・調合します。

## 施術の注意点

1. **パッチテストの実施**：アレルギー反応を防ぐため必須
2. **放置時間の管理**：メーカー指定の時間を守る
3. **温度管理**：室温や加温の有無で発色が変わる

## まとめ

カラーリングは科学的な知識と芸術的なセンスが求められる技術です。基礎をしっかり学び、経験を積むことで、理想の色を作り出せるようになります。`,
    summary: "カラーリングの基本となる色彩理論から、実際の薬剤選定方法まで、プロの美容師に必要な知識を網羅的に解説します。"
  },
  {
    number: 4,
    title: "パーマの基礎技術：ロッド選定からウェーブデザインまで",
    content: `## パーマ技術の概要

パーマは髪に半永久的なウェーブやカールを作る技術です。お客様の髪質やライフスタイルに合わせた提案が重要になります。

## パーマの原理

### 1. 還元反応
1剤（還元剤）により、髪のシスチン結合を切断します。

### 2. 酸化反応
2剤（酸化剤）により、新しい形でシスチン結合を再結合させます。

## ロッドの選定

### ロッドの太さによる違い
- **細いロッド（6-8mm）**：しっかりとしたカール
- **中間ロッド（10-13mm）**：自然なウェーブ
- **太いロッド（15mm以上）**：ゆるやかな動き

### 巻き方の種類
1. **平巻き**：均一なカール
2. **スパイラル巻き**：縦長のウェーブ
3. **ツイスト巻き**：動きのあるカール

## ウェーブデザインの考え方

### 1. 顔型に合わせたデザイン
- 丸顔：トップにボリューム
- 面長：サイドにボリューム
- ベース型：あご周りを軽く

### 2. ライフスタイルの考慮
- 朝の手入れ時間
- スタイリング技術
- 髪を洗う頻度

## 施術のポイント

1. **前処理の重要性**：ダメージ部分の保護
2. **薬剤の選定**：髪質に合わせた強さを選ぶ
3. **中間水洗**：1剤をしっかり流す
4. **アフターケア**：施術後の注意事項を説明

## まとめ

パーマは技術と経験が必要な施術です。基礎をしっかり理解し、様々なスタイルに挑戦することで、技術が向上していきます。`,
    summary: "パーマの基本原理からロッド選定、ウェーブデザインまで、美容師が知っておくべきパーマ技術の基礎を詳しく解説します。"
  },
  {
    number: 5,
    title: "ブロードライの極意：艶とボリュームを生み出すテクニック",
    content: `## ブロードライの重要性

ブロードライは、カットの仕上がりを左右する重要な技術です。正しいブロー技術により、髪に艶とまとまりを与え、スタイルを長持ちさせることができます。

## 基本的な道具と使い方

### 1. ドライヤーの選び方
- 風量：1.3㎥/分以上
- 温度調節機能
- マイナスイオン機能

### 2. ブラシの種類と用途
- **デンマンブラシ**：ストレートスタイル
- **ロールブラシ**：カールやボリューム
- **スケルトンブラシ**：ナチュラルな仕上がり

## ブロー技術の基本

### 1. 下準備
- タオルドライで水分を取る
- 洗い流さないトリートメントを塗布
- 髪を適切にブロッキング

### 2. 根元から乾かす
根元から毛先に向かって、キューティクルの方向に沿って風を当てます。

### 3. テンションのかけ方
適度なテンションをかけながら、ブラシと ドライヤーを連動させて動かします。

## スタイル別テクニック

### ストレートスタイル
1. 根元を立ち上げながら乾かす
2. 中間から毛先はテンションをかけて真っ直ぐに
3. 最後に冷風で仕上げる

### ボリュームスタイル
1. 根元を逆方向に乾かす
2. ロールブラシで内巻きに
3. トップは持ち上げながら乾かす

### ナチュラルスタイル
1. 手ぐしで乾かす
2. 8割乾いたらブラシを使用
3. 自然な動きを残す

## プロのコツ

1. **温度管理**：髪質に合わせて温度を調節
2. **風の角度**：45度の角度が理想的
3. **仕上げの冷風**：キューティクルを閉じて艶を出す

## まとめ

ブロードライは練習を重ねることで確実に上達します。基本を大切にしながら、様々なテクニックを身につけていきましょう。`,
    summary: "プロの美容師が実践するブロードライテクニックを、基本から応用まで分かりやすく解説。艶髪とボリュームアップの秘訣を公開します。"
  },
  {
    number: 6,
    title: "カウンセリング力向上！お客様の本音を引き出す会話術",
    content: `## カウンセリングの重要性

美容師にとってカウンセリングは、お客様の満足度を決める最も重要な要素の一つです。技術力だけでなく、コミュニケーション能力も同様に大切です。

## 効果的なカウンセリングの流れ

### 1. 第一印象を大切に
- 笑顔での挨拶
- アイコンタクト
- 清潔感のある身だしなみ

### 2. オープンクエスチョンの活用
「どんな感じにしたいですか？」ではなく、
「普段のスタイリングで困っていることはありますか？」
といった具体的な質問をする。

### 3. 傾聴の技術
- 相づちを打つ
- 要約して確認する
- 感情に共感する

## お客様のタイプ別対応法

### おしゃべり好きなお客様
- 話を遮らず最後まで聞く
- 共感を示しながら要点をまとめる
- 施術に関する話題に自然に誘導

### 無口なお客様
- Yes/Noで答えられる質問から始める
- 雑誌や写真を使って視覚的に確認
- 沈黙を恐れない

### こだわりの強いお客様
- 要望を詳細にメモする
- 実現可能性を正直に伝える
- 代替案を提示する

## 本音を引き出すテクニック

### 1. ライフスタイルの質問
- 朝の準備時間
- 髪を洗う頻度
- 普段のスタイリング方法

### 2. 過去の経験を聞く
- 気に入ったスタイル
- 失敗した経験
- 他店での体験

### 3. 理想と現実のギャップを埋める
お客様の理想を聞きながら、髪質や生活習慣を考慮した現実的な提案をする。

## NGな会話例と改善策

### NG例1
「この髪質だと難しいですね」
→「この髪質を活かして、こんなスタイルはいかがでしょうか」

### NG例2
「前の美容師さんのカット、ちょっと...」
→「今日はもっと素敵にしていきましょう」

## まとめ

カウンセリング力は経験とともに向上します。お客様一人ひとりに合わせた対応を心がけ、信頼関係を築いていきましょう。`,
    summary: "美容師のカウンセリング技術を向上させる実践的な会話術。お客様の本音を引き出し、満足度を高めるコミュニケーション方法を解説します。"
  },
  {
    number: 21,
    title: "美容室開業の完全ガイド：資金計画から物件選びまで",
    content: `## 美容室開業への第一歩

独立開業は多くの美容師の夢です。しかし、技術力だけでなく経営者としての知識とスキルが必要になります。本記事では、開業準備の全体像を解説します。

## 開業資金の計画

### 必要資金の内訳
1. **初期投資**（500-1500万円）
   - 物件取得費（保証金・礼金）
   - 内装工事費
   - 設備・器具購入費
   - 広告宣伝費

2. **運転資金**（300-500万円）
   - 3-6ヶ月分の固定費
   - 材料仕入れ費
   - 人件費

### 資金調達方法
- 自己資金（最低30%推奨）
- 日本政策金融公庫
- 銀行融資
- リース活用

## 物件選びのポイント

### 1. 立地条件
- **商圏分析**：半径500m-1kmの人口構成
- **競合調査**：周辺美容室の数と特徴
- **アクセス**：駅からの距離、駐車場の有無

### 2. 物件の条件
- 面積：15-30坪（スタッフ1人あたり5坪目安）
- 給排水設備の確認
- 電気容量（最低30A以上）
- 換気設備

### 3. 契約条件の確認
- 保証金・礼金の金額
- 契約期間と更新条件
- 原状回復の範囲

## 事業計画書の作成

### 1. 経営理念とコンセプト
- ターゲット顧客の明確化
- 差別化ポイント
- 提供価値

### 2. 売上計画
- 客単価の設定
- 来店サイクルの想定
- 月間売上目標

### 3. 損益計画
- 固定費の算出
- 変動費の見積もり
- 損益分岐点の計算

## 開業までのスケジュール

### 6ヶ月前
- 事業計画書作成
- 資金調達準備

### 3ヶ月前
- 物件契約
- 内装工事開始
- スタッフ採用

### 1ヶ月前
- 保健所申請
- 広告宣伝開始
- プレオープン準備

## 成功のポイント

1. **余裕のある資金計画**：想定の1.5倍の資金を準備
2. **差別化戦略**：他店にない強みを作る
3. **集客の仕組み作り**：開業前から顧客リストを作る

## まとめ

美容室開業は大きな挑戦ですが、しっかりとした準備と計画があれば成功の可能性は高まります。焦らず着実に準備を進めていきましょう。`,
    summary: "美容室を開業するために必要な資金計画、物件選び、事業計画の立て方まで、独立を目指す美容師のための完全ガイドです。"
  },
  {
    number: 41,
    title: "美容室DXの第一歩：予約システムのデジタル化",
    content: `## デジタルトランスフォーメーション（DX）とは

美容室におけるDXとは、デジタル技術を活用して業務効率を改善し、顧客体験を向上させることです。その第一歩として最適なのが予約システムのデジタル化です。

## 予約システムデジタル化のメリット

### 1. 業務効率の向上
- 電話対応時間の削減
- ダブルブッキングの防止
- スタッフのスケジュール管理自動化

### 2. 顧客満足度の向上
- 24時間予約受付
- 予約変更の簡易化
- 待ち時間の可視化

### 3. データ活用
- 予約傾向の分析
- 顧客行動の把握
- 売上予測の精度向上

## 主要な予約システムの比較

### 1. ホットペッパービューティー
**メリット**
- 圧倒的な集客力
- 知名度の高さ
- POSシステムとの連携

**デメリット**
- 手数料が高い
- 価格競争に巻き込まれやすい

### 2. 独自予約システム
**メリット**
- 手数料なし
- カスタマイズ自由
- 顧客データの完全管理

**デメリット**
- 初期導入コスト
- 集客は自力

### 3. LINE予約
**メリット**
- 利用者が多い
- 操作が簡単
- プッシュ通知機能

**デメリット**
- 機能が限定的
- データ分析が弱い

## 導入ステップ

### Step1：現状分析
- 現在の予約方法と課題
- 月間予約件数
- 電話対応時間

### Step2：システム選定
- 予算の設定
- 必要機能の洗い出し
- デモ版での試用

### Step3：段階的導入
1. スタッフ教育
2. 既存顧客への案内
3. 新規顧客への展開

### Step4：運用改善
- 利用率のモニタリング
- フィードバック収集
- システムの最適化

## 成功事例

### 事例1：個人サロンA
- 導入前：電話予約のみ、月200件
- 導入後：ネット予約70%、月300件
- 効果：売上30%アップ、電話対応80%削減

### 事例2：中規模サロンB
- 導入前：紙の予約帳管理
- 導入後：クラウド型予約システム
- 効果：ダブルブッキングゼロ、顧客満足度向上

## 注意点とコツ

1. **段階的な移行**：いきなり完全デジタル化せず、併用期間を設ける
2. **スタッフ教育**：システムの使い方だけでなく、メリットも伝える
3. **顧客への丁寧な説明**：特に年配の顧客には個別サポート

## まとめ

予約システムのデジタル化は、美容室DXの重要な第一歩です。自店に合ったシステムを選び、段階的に導入することで、業務効率と顧客満足度の両方を向上させることができます。`,
    summary: "美容室のDX化の第一歩となる予約システムのデジタル化について、メリット、選び方、導入方法を実例を交えて詳しく解説します。"
  },
  {
    number: 61,
    title: "トレンドを先取り！2024年注目のヘアスタイル",
    content: `## 2024年ヘアトレンドの全体像

ファッションと同様に、ヘアスタイルにもトレンドがあります。2024年は「自然体でありながら洗練された」スタイルが主流となっています。

## 注目のヘアスタイル

### 1. モダンシャグ
**特徴**
- レイヤーを活かした動きのあるスタイル
- 顔周りの軽やかさ
- スタイリングが簡単

**おすすめの顧客**
- 直毛〜ややクセ毛
- カジュアルな雰囲気を好む
- 20代〜40代

### 2. フレンチボブ
**特徴**
- あご下ラインの上品な長さ
- 毛先のワンカール
- 前髪はシースルーor流し

**おすすめの顧客**
- 大人っぽさを求める女性
- オフィスワーカー
- 30代〜50代

### 3. ウルフカット2.0
**特徴**
- 従来のウルフより女性らしい
- トップの立体感
- 襟足の自然な流れ

**おすすめの顧客**
- 個性的なスタイルを好む
- 髪に動きが欲しい
- 全年齢対応

## カラートレンド

### 1. ミルクティーベージュ
- 透明感のある柔らかい色味
- 日本人の肌に馴染みやすい
- ブリーチ必須

### 2. オリーブグレージュ
- くすみ感のある大人カラー
- 赤味を抑えた仕上がり
- ブリーチなしでも可能

### 3. インナーカラー
- さりげない個性の表現
- メンテナンスが楽
- 職場でも対応可能

## 質感トレンド

### 1. エアリー質感
- 軽やかで柔らかい仕上がり
- 重さを感じさせない
- パーマとの相性◎

### 2. ウェット質感
- 濡れ髪風スタイリング
- 色気のある仕上がり
- オイル系スタイリング剤使用

### 3. マット質感
- ナチュラルで健康的
- 過度なツヤを抑える
- クレイ系スタイリング剤使用

## トレンドの取り入れ方

### 1. 部分的な取り入れ
全体を変えるのではなく、前髪や顔周りだけトレンドを取り入れる

### 2. 顧客に合わせたアレンジ
トレンドをそのまま再現するのではなく、顧客の骨格や髪質に合わせてカスタマイズ

### 3. メンテナンスの説明
トレンドスタイルを維持するための来店頻度やホームケアを事前に説明

## SNS活用のポイント

1. **ビフォーアフター投稿**：変化が分かりやすい
2. **動画での質感表現**：静止画では伝わらない動きを見せる
3. **スタイリング解説**：再現性を高める

## まとめ

トレンドを押さえることは重要ですが、最も大切なのは顧客一人ひとりに似合うスタイルを提案することです。トレンドを参考にしながら、オリジナリティのある提案を心がけましょう。`,
    summary: "2024年の最新ヘアトレンドを徹底解説。注目のスタイル、カラー、質感から、顧客への提案方法まで、美容師必見の情報をお届けします。"
  }
];

// 記事のアクセスレベルを決定する関数
function determineAccessLevel(articleNumber) {
  const positionInChapter = ((articleNumber - 1) % 20) + 1;
  if (positionInChapter <= 5) return 'free';
  else if (positionInChapter <= 15) return 'partial';
  else return 'premium';
}

// チャプターIDを取得する関数
function getChapterNumber(articleNumber) {
  return Math.ceil(articleNumber / 20);
}

// 記事のスラッグを生成
function generateSlug(articleNumber) {
  return String(articleNumber).padStart(3, '0');
}

async function postSampleArticles() {
  try {
    console.log('📚 サンプル記事の投稿を開始します...\n');

    // チャプター情報を取得
    const { data: chapters, error: chaptersError } = await supabase
      .from('education_chapters')
      .select('*')
      .order('chapter_number');

    if (chaptersError) {
      throw new Error(`チャプター取得エラー: ${chaptersError.message}`);
    }

    console.log(`✅ ${chapters.length}個のチャプターを取得しました\n`);

    // サンプル記事を投稿
    for (const article of sampleArticles) {
      // 既に存在する記事はスキップ
      const { data: existing } = await supabase
        .from('education_contents')
        .select('id')
        .eq('article_number', article.number)
        .single();

      if (existing) {
        console.log(`⏭️  記事${article.number}は既に存在します`);
        continue;
      }

      // チャプターIDを取得
      const chapterNumber = getChapterNumber(article.number);
      const chapter = chapters.find(c => c.chapter_number === chapterNumber);
      
      if (!chapter) {
        console.error(`❌ チャプター${chapterNumber}が見つかりません`);
        continue;
      }

      // 公開日を設定（順次公開）
      const publishDate = new Date();
      publishDate.setDate(publishDate.getDate() + Math.floor((article.number - 1) / 2));

      // データベースに保存
      const educationContent = {
        chapter_id: chapter.id,
        article_number: article.number,
        title: article.title,
        slug: generateSlug(article.number),
        content: article.content,
        preview_content: article.content.substring(0, 500) + '...',
        excerpt: article.summary,
        is_premium: determineAccessLevel(article.number) === 'premium',
        access_level: determineAccessLevel(article.number),
        reading_time: 7,
        status: publishDate <= new Date() ? 'published' : 'scheduled',
        publish_date: publishDate.toISOString(),
        seo_title: article.title,
        seo_description: article.summary,
        internal_links: []
      };

      const { error } = await supabase
        .from('education_contents')
        .insert(educationContent);

      if (error) {
        console.error(`❌ 記事${article.number}の投稿エラー:`, error.message);
      } else {
        console.log(`✅ 記事${article.number}「${article.title}」を投稿しました`);
      }
    }

    // 最終的な記事数を確認
    const { count: finalCount } = await supabase
      .from('education_contents')
      .select('*', { count: 'exact', head: true });

    console.log(`\n🎉 処理完了！`);
    console.log(`📊 データベース内の記事数: ${finalCount}/80`);
    console.log('\n💡 ヒント: 残りの記事はGemini APIキーを設定後、generate-and-post-all-articles.jsで生成できます。');
    console.log('📱 ローカルで確認: http://localhost:3000/education');

  } catch (error) {
    console.error('❌ エラー:', error);
    process.exit(1);
  }
}

// 実行
postSampleArticles();
const { createClient } = require('@supabase/supabase-js');
const path = require('path');
require('dotenv').config({ path: path.join(__dirname, '../.env.local') });

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
);

// æŠ€è¡“æŒ‡å°Žç³»ã®è¨˜äº‹ã‚’ç‰¹å®š
const technicalArticles = [
  { number: 2, oldTitle: "å¤±æ•—ã—ãªã„ï¼æ–°äººç¾Žå®¹å¸«ã®ãŸã‚ã®ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼æŠ€è¡“å®Œå…¨ã‚¬ã‚¤ãƒ‰" },
  { number: 3, oldTitle: "ã‚«ãƒ©ãƒ¼ãƒªãƒ³ã‚°ã®åŸºç¤ŽçŸ¥è­˜ï¼šè‰²å½©ç†è«–ã‹ã‚‰è–¬å‰¤é¸å®šã¾ã§" },
  { number: 4, oldTitle: "ãƒ‘ãƒ¼ãƒžã®åŸºç¤ŽæŠ€è¡“ï¼šãƒ­ãƒƒãƒ‰é¸å®šã‹ã‚‰ã‚¦ã‚§ãƒ¼ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã¾ã§" },
  { number: 5, oldTitle: "ãƒ–ãƒ­ãƒ¼ãƒ‰ãƒ©ã‚¤ã®æ¥µæ„ï¼šè‰¶ã¨ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ç”Ÿã¿å‡ºã™ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯" },
  { number: 11, oldTitle: "ãƒã‚µãƒŸã®é¸ã³æ–¹ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ–¹æ³•" },
  { number: 12, oldTitle: "ã‚«ãƒƒãƒˆç†è«–ã®åŸºç¤Žï¼šãƒ™ãƒ¼ã‚·ãƒƒã‚¯ã‚«ãƒƒãƒˆã‹ã‚‰å¿œç”¨ã¾ã§" },
  { number: 13, oldTitle: "è–¬å‰¤çŸ¥è­˜ï¼šå®‰å…¨ãªæ–½è¡“ã®ãŸã‚ã®åŒ–å­¦åŸºç¤Ž" },
  { number: 15, oldTitle: "ã‚·ã‚¶ãƒ¼ãƒ¯ãƒ¼ã‚¯ã®åŸºæœ¬å‹•ä½œã¨ç·´ç¿’æ–¹æ³•" },
  { number: 18, oldTitle: "ã‚«ãƒ©ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®èª­ã¿æ–¹ã¨è‰²ã®é…åˆç†è«–" }
];

// ãƒ“ã‚¸ãƒã‚¹ãƒ»å¿ƒç†å­¦ç³»ã®æ–°ã—ã„ã‚¿ã‚¤ãƒˆãƒ«
const replacementArticles = [
  { 
    number: 2, 
    title: "ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼ä¸­ã®ä¼šè©±è¡“ï¼šãƒªãƒ©ã‚¯ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã¨ä¿¡é ¼æ§‹ç¯‰ã®å¿ƒç†å­¦",
    content: "ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼ã‚¿ã‚¤ãƒ ã¯ã€ãŠå®¢æ§˜ãŒæœ€ã‚‚ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã€å¿ƒã‚’é–‹ãã‚„ã™ã„è²´é‡ãªæ™‚é–“ã§ã™ã€‚ã“ã®15åˆ†é–“ã®ä½¿ã„æ–¹æ¬¡ç¬¬ã§ã€é¡§å®¢æº€è¶³åº¦ã¨ãƒªãƒ”ãƒ¼ãƒˆçŽ‡ãŒå¤§ããå¤‰ã‚ã‚Šã¾ã™..."
  },
  { 
    number: 3, 
    title: "ã‚«ãƒ©ãƒ¼ãƒªãƒ³ã‚°ææ¡ˆã®å¿ƒç†å­¦ï¼šè‰²å½©ãŒã‚‚ãŸã‚‰ã™å°è±¡å¤‰åŒ–ã¨é¡§å®¢æº€è¶³åº¦",
    content: "é«ªè‰²ã®å¤‰åŒ–ã¯ã€ãŠå®¢æ§˜ã®è‡ªå·±ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ç¤¾ä¼šçš„å°è±¡ã‚’å¤§ããå·¦å³ã—ã¾ã™ã€‚è‰²å½©å¿ƒç†å­¦ã‚’ç†è§£ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šæº€è¶³åº¦ã®é«˜ã„ææ¡ˆãŒå¯èƒ½ã«ãªã‚Šã¾ã™..."
  },
  { 
    number: 4, 
    title: "ãƒ‘ãƒ¼ãƒžãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ä¾¡å€¤ææ¡ˆï¼šæ™‚çŸ­ãƒ‹ãƒ¼ã‚ºã¨ä»˜åŠ ä¾¡å€¤ã®è¨´æ±‚æ–¹æ³•",
    content: "ç¾ä»£ã®å¿™ã—ã„å¥³æ€§ã«ã¨ã£ã¦ã€æœã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°æ™‚é–“çŸ­ç¸®ã¯å¤§ããªä¾¡å€¤ã§ã™ã€‚ãƒ‘ãƒ¼ãƒžã®çœŸã®ä¾¡å€¤ã‚’ä¼ãˆã‚‹ææ¡ˆæ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™..."
  },
  { 
    number: 5, 
    title: "ãƒ‰ãƒ©ã‚¤ãƒ¤ãƒ¼ã‚¿ã‚¤ãƒ ã®æŽ¥å®¢è¡“ï¼šä¼šè©±ã¨æ²ˆé»™ã®ãƒãƒ©ãƒ³ã‚¹ã‚’æ¥µã‚ã‚‹",
    content: "ãƒ‰ãƒ©ã‚¤ãƒ¤ãƒ¼ã®éŸ³ã§ä¼šè©±ãŒå›°é›£ãªæ™‚é–“å¸¯ã®æŽ¥å®¢ã¯ã€ç¾Žå®¹å¸«ã®è…•ã®è¦‹ã›æ‰€ã§ã™ã€‚éžè¨€èªžã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ´»ç”¨ã—ãŸæº€è¶³åº¦å‘ä¸Šã®æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™..."
  },
  { 
    number: 11, 
    title: "ãƒ—ãƒ­ç”¨å“ã¸ã®æŠ•è³‡åŠ¹æžœï¼šé¡§å®¢ãŒæ„Ÿã˜ã‚‹ä¾¡å€¤ã¨æ–™é‡‘è¨­å®šã®é–¢ä¿‚",
    content: "é«˜å“è³ªãªé“å…·ã¸ã®æŠ•è³‡ã¯ã€é¡§å®¢æº€è¶³åº¦ã¨ä¾¡æ ¼è¨­å®šã«ç›´çµã—ã¾ã™ã€‚æŠ•è³‡åŠ¹æžœã‚’æœ€å¤§åŒ–ã™ã‚‹è€ƒãˆæ–¹ã¨ã€é¡§å®¢ã¸ã®ä¾¡å€¤ã®ä¼ãˆæ–¹ã‚’è§£èª¬ã—ã¾ã™..."
  },
  { 
    number: 12, 
    title: "ã‚«ãƒƒãƒˆæ™‚é–“ã®ä¾¡å€¤æœ€å¤§åŒ–ï¼šæ–½è¡“ä¸­ã®ä»˜åŠ ä¾¡å€¤ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›æ–¹æ³•",
    content: "ã‚«ãƒƒãƒˆä¸­ã®æ™‚é–“ã¯ã€å˜ãªã‚‹æ–½è¡“æ™‚é–“ã§ã¯ãªãã€é¡§å®¢ä½“é¨“ã‚’é«˜ã‚ã‚‹æ©Ÿä¼šã§ã™ã€‚ä¼šè©±ã€ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã€ãƒªãƒ©ã‚¯ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã‚’çµ„ã¿åˆã‚ã›ãŸä¾¡å€¤æä¾›ã®æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™..."
  },
  { 
    number: 13, 
    title: "å®‰å…¨æ€§ã‚¢ãƒ”ãƒ¼ãƒ«ã«ã‚ˆã‚‹å·®åˆ¥åŒ–æˆ¦ç•¥ï¼šä¿¡é ¼ç²å¾—ã¨ãƒ—ãƒ¬ãƒŸã‚¢ãƒ åŒ–",
    content: "å®‰å…¨æ€§ã¸ã®é…æ…®ã¯ã€é«˜ä¾¡æ ¼å¸¯ã‚µãƒ­ãƒ³ã®é‡è¦ãªå·®åˆ¥åŒ–è¦ç´ ã§ã™ã€‚å®‰å…¨å¯¾ç­–ã‚’é¡§å®¢ä¾¡å€¤ã«å¤‰æ›ã™ã‚‹æ–¹æ³•ã¨ã€ä¿¡é ¼æ§‹ç¯‰ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’è§£èª¬ã—ã¾ã™..."
  },
  { 
    number: 15, 
    title: "æ–½è¡“ã®è¦‹ã›æ–¹ãƒžãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ï¼šSNSæ™‚ä»£ã®è¦–è¦šçš„è¨´æ±‚æ–¹æ³•",
    content: "æ–½è¡“ãƒ—ãƒ­ã‚»ã‚¹ã®ç¾Žã—ã•ã¯ã€SNSãƒžãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã®é‡è¦ãªè¦ç´ ã§ã™ã€‚æ’®å½±æ˜ ãˆã™ã‚‹æ–½è¡“ã®æ¼”å‡ºæ–¹æ³•ã¨ã€é›†å®¢ã«ã¤ãªã’ã‚‹æ´»ç”¨è¡“ã‚’ç´¹ä»‹ã—ã¾ã™..."
  },
  { 
    number: 18, 
    title: "è‰²å½©ææ¡ˆã«ã‚ˆã‚‹å®¢å˜ä¾¡ã‚¢ãƒƒãƒ—ï¼šãƒã‚¤ãƒ©ã‚¤ãƒˆã¨ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¾¡å€¤è¨´æ±‚",
    content: "è¤‡é›‘ãªè‰²å½©æŠ€è¡“ã¯é«˜å˜ä¾¡ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æŸ±ã§ã™ã€‚æŠ€è¡“ã®ä¾¡å€¤ã‚’åˆ†ã‹ã‚Šã‚„ã™ãä¼ãˆã€ç´å¾—ã—ã¦é¸ã‚“ã§ã‚‚ã‚‰ã†ãŸã‚ã®ææ¡ˆæ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™..."
  }
];

async function replaceTechnicalArticles() {
  console.log('ðŸ”„ æŠ€è¡“æŒ‡å°Žç³»è¨˜äº‹ã‚’ãƒ“ã‚¸ãƒã‚¹ç³»ã«ç½®ãæ›ãˆã¾ã™...\n');
  
  let successCount = 0;
  let errorCount = 0;
  
  for (const replacement of replacementArticles) {
    try {
      // æ—¢å­˜ã®è¨˜äº‹ã‚’ç¢ºèª
      const { data: existing } = await supabase
        .from('education_contents')
        .select('*')
        .eq('article_number', replacement.number)
        .single();
      
      if (!existing) {
        console.log(`âŒ è¨˜äº‹${replacement.number}ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
        errorCount++;
        continue;
      }
      
      // è¨˜äº‹ã‚’æ›´æ–°
      const { error } = await supabase
        .from('education_contents')
        .update({
          title: replacement.title,
          content: replacement.content,
          excerpt: replacement.content.substring(0, 150) + '...',
          seo_title: replacement.title,
          seo_description: replacement.content.substring(0, 150)
        })
        .eq('article_number', replacement.number);
      
      if (error) {
        console.error(`âŒ è¨˜äº‹${replacement.number}ã®æ›´æ–°ã‚¨ãƒ©ãƒ¼:`, error.message);
        errorCount++;
      } else {
        console.log(`âœ… è¨˜äº‹${replacement.number}: ${replacement.title}`);
        successCount++;
      }
      
    } catch (error) {
      console.error(`âŒ ã‚¨ãƒ©ãƒ¼:`, error.message);
      errorCount++;
    }
  }
  
  console.log(`\nðŸ“Š å®Œäº†: ${successCount}è¨˜äº‹ã‚’æ›´æ–°ã€${errorCount}ä»¶ã®ã‚¨ãƒ©ãƒ¼`);
  
  // æ›´æ–°å¾Œã®ç¢ºèª
  const { data: updatedArticles } = await supabase
    .from('education_contents')
    .select('article_number, title')
    .in('article_number', replacementArticles.map(a => a.number))
    .order('article_number');
  
  console.log('\nðŸ“ æ›´æ–°å¾Œã®ã‚¿ã‚¤ãƒˆãƒ«:');
  updatedArticles?.forEach(article => {
    console.log(`  ${article.article_number}. ${article.title}`);
  });
}

replaceTechnicalArticles();